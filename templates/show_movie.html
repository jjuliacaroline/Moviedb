{% extends "layout.html" %}

{% block title %}{{ movie.title }}{% endblock %}

{% block content %}
<h2>{{ movie.title }}</h2>
{% if session.user_id == movie.user_id %}
<p>
  <a href="/edit_movie/{{ movie.id }}">Muokkaa</a>
  <a href="/remove_movie/{{ movie.id }}">Poista</a>
</p>
{% endif %}

<p>
  {{ movie.description | show_lines }}
</p>

<ul>
  <li>Julkaisuvuosi: {{ movie.release_year }}</li>
  <li>Arvioija: <a href="/user/{{ movie.user_id }}">{{ movie.username }}</a></li>
</ul>

<h3>Genret</h3>
<ul>
  {% for genre in genres %}
  <li>{{ genre.title }}</li>
  {% endfor %}
</ul>

<h3>Arviot</h3>
<ul>
  {% for rating in ratings %}
  <li>{{ rating.rating }} / 5, arvioija: <a href="/user/{{ rating.user_id }}">{{ rating.username }}</a></li>
  {% endfor %}
</ul>

{% if session.user_id %}
  {% if user_rating %}
    <h3>Oma arviosi</h3>
    <form action="/update_rating" method="post">
      <label for="rating">Muokkaa arvosanaasi (1–5):</label>
      <input type="number" id="rating" name="rating" min="1" max="5" value="{{ user_rating.rating }}" required />
      <input type="hidden" name="movie_id" value="{{ movie.id }}" />
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
      <input type="submit" value="Päivitä arvio" />
    </form>

    <form action="/delete_rating" method="post" style="margin-top: 5px;">
      <input type="hidden" name="movie_id" value="{{ movie.id }}" />
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
      <input type="submit" value="Poista arvio" />
    </form>
  {% else %}
    <h3>Lisää arvio</h3>
    <form action="/add_rating" method="post">
      <label for="rating">Anna arvosana (1–5):</label>
      <input type="number" id="rating" name="rating" min="1" max="5" required />
      <input type="hidden" name="movie_id" value="{{ movie.id }}" />
      <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
      <input type="submit" value="Lisää arvio" />
    </form>
  {% endif %}
{% endif %}


<h3>Kommentit</h3>
{% for comment in comments %}
  <p><strong>{{ comment.username }}:</strong> {{ comment.content|show_lines }}</p>
{% else %}
  <p>Ei kommentteja.</p>
{% endfor %}

<form method="post" action="/add_comment">
  <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}">
  <input type="hidden" name="movie_id" value="{{ movie.id }}">
  <label for="comment">Kommentti:</label><br>
  <textarea name="content" id="comment" required></textarea><br>
  <button type="submit">Lisää kommentti</button>
</form>

{% endblock %}
